<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Team Dashboard</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>

<div class="card" style="width:820px; margin:auto;">

  <!-- HEADER -->
  <div style="display:flex;align-items:center;gap:15px;margin-bottom:15px;">
      <img id="teamLogo" src="default-player.png"
           style="width:70px;height:70px;border-radius:8px;object-fit:cover;">
      <h2 id="teamTitle" style="margin:0;">Team Dashboard</h2>
  </div>

  <p><strong>Purse:</strong> <span id="purse">-</span></p>
  <div id="myPlayers" style="display:none;"></div>
  <h3 style="margin-top:25px;">Retain a Player</h3>

<div style="display:flex; gap:10px; align-items:flex-start; position:relative; z-index:10000;">

    <!-- Search Box -->
    <div style="position:relative;">
       <input id="playerSearch" placeholder="Select Player to Retain"
       style="padding:10px; width:260px; border:1px solid #555;">
         <input type="hidden" id="retainPlayerId">


        <!-- Search Results -->
        
<div id="searchResults"
     style="
        display:none;
        position:absolute;
        width:260px;
        background:white;
        color:black;
        border:1px solid #ccc;
        max-height:250px;
        overflow-y:auto;
        z-index:9999;
        border-radius:6px;
     ">
</div>


    </div>

    <!-- Price Input -->
    <input id="retainPrice" placeholder="Enter Price "
           style="padding:10px; width:150px; border:1px solid #555; 
                  border-radius:6px; background:#111; color:white;">

    <!-- Button -->
    <button id="retainBtn"
            style="padding:10px 18px; border:none; background:#007bff; 
                   color:white; border-radius:6px; cursor:pointer;">
        RETAIN
    </button>
</div>


  <!-- SQUAD -->
  <h3>Your Squad</h3>

  <div style="display:flex;gap:20px;flex-wrap:wrap;">

    <div style="flex:1;">
      <h4>Batsmen</h4>
      <div id="batList" class="roleBox"></div>
    </div>

    <div style="flex:1;">
      <h4>Bowlers</h4>
      <div id="bowlList" class="roleBox"></div>
    </div>

    <div style="flex:1;">
      <h4>All Rounders</h4>
      <div id="arList" class="roleBox"></div>
    </div>

    <div style="flex:1;">
      <h4>Wicket Keepers</h4>
      <div id="wkList" class="roleBox"></div>
    </div>

  </div>
  

  <!-- CURRENT PLAYER -->
  <h3 style="margin-top:30px;">Current Player</h3>

  <div id="live-panel" style="border:1px solid #ddd;padding:12px;border-radius:8px;">
    <img id="pImg" src="default-player.png"
         style="width:130px;height:130px;object-fit:cover;border-radius:8px;">
    
    <p><b>Name:</b> <span id="pName">-</span></p>
    <p><b>Role:</b> <span id="pRole">-</span></p>
    <p><b>Country:</b> <span id="pCountry">-</span></p>
    <p><b>Base Price:</b> ₹ <span id="basePrice">-</span></p>
    <p><b>Current Bid:</b> ₹ <span id="pBid">-</span></p>
    <p><b>Highest Bidder:</b> <span id="highest">-</span></p>
    <p><b>Teams Interested:</b> <span id="interest">-</span></p>

    <button id="bidBtn"> BID</button>
  </div>

</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script src="firebase.js"></script>
<script src="team.js?v=3"></script>
<script>
 db.collection("auction").doc("current").onSnapshot(async snap => {
    if (!snap.exists) return;

    const data = snap.data();

    // If no player active → clear UI
    if (!data.playerID) {
        document.getElementById("pName").innerText = "-";
        document.getElementById("pRole").innerText = "-";
        document.getElementById("pCountry").innerText = "-";
        document.getElementById("basePrice").innerText = "-";
        document.getElementById("pBid").innerText = "-";
        document.getElementById("highest").innerText = "-";
        document.getElementById("interest").innerText = "-";
        return;
    }

    // Load player
    const pSnap = await db.collection("players").doc(data.playerID).get();
    const p = pSnap.data();

    document.getElementById("pName").innerText = p.name;
    document.getElementById("pRole").innerText = p.role;
    document.getElementById("pCountry").innerText = p.country;
    document.getElementById("basePrice").innerText = formatPrice(p.basePrice);
    document.getElementById("pBid").innerText = formatPrice(data.currentBid);
    document.getElementById("highest").innerText = data.highestBidder || "-";
    document.getElementById("interest").innerText = (data.interestedTeams || []).join(", ") || "-";
});

</script>

</body>
</html>